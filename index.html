<!DOCTYPE html>

<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <meta name="theme-color" content="#0f172a">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="GeoFotos">
  <link rel="manifest" href="manifest.json">
  <link rel="apple-touch-icon" href="icons/icon-192.png">
  <link rel="stylesheet" href="css/styles.css">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <title>GeoFotos</title>
</head>
<body>
  <header>
    <h1>üìç GeoFotos</h1>
  </header>

  <div class="tabs">
    <button class="tab active" data-view="capture">Capturar</button>
    <button class="tab" data-view="history">Hist√≥rico</button>
    <button class="tab" data-view="map">Mapa</button>
    <button class="tab" data-view="settings">Configura√ß√µes</button>
  </div>

  <!-- View: Capturar -->

  <div id="capture" class="view active">
    <!-- Monitor de GPS em tempo real -->
    <div class="card gps-monitor" id="gpsMonitor">
      <div class="gps-monitor-header">
        <span class="gps-icon" id="gpsIcon">üì°</span>
        <span class="gps-title">Sinal GPS</span>
        <button class="btn btn-secondary btn-small" id="toggleGpsBtn" title="Pausar/Retomar monitoramento">‚è∏Ô∏è</button>
      </div>
      <div class="gps-monitor-content">
        <div class="gps-status" id="gpsStatus">Iniciando...</div>
        <div class="gps-accuracy" id="gpsAccuracy"></div>
        <div class="gps-coords-live" id="gpsCoordsLive"></div>
      </div>
      <div class="gps-bar-container">
        <div class="gps-bar" id="gpsBar"></div>
      </div>
    </div>

    <div class="card">
      <h3 style="margin-bottom: 16px;">üì∏ Foto + Localiza√ß√£o</h3>
      <input type="file" id="cameraInput" accept="image/*" capture="environment">
      <button class="btn btn-primary" id="takePhotoBtn">
        <svg width="20" height="20" fill="currentColor" viewBox="0 0 24 24"><path d="M12 15.2a3.2 3.2 0 1 0 0-6.4 3.2 3.2 0 0 0 0 6.4z"/><path d="M9 2 7.17 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2h-3.17L15 2H9zm3 15c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5z"/></svg>
        Tirar Foto
      </button>
    </div>

    <div class="card">
      <h3 style="margin-bottom: 16px;">üé¨ V√≠deo + Localiza√ß√£o</h3>
      <input type="file" id="videoInput" accept="video/*" capture="environment">
      <button class="btn btn-primary" id="takeVideoBtn">
        <svg width="20" height="20" fill="currentColor" viewBox="0 0 24 24"><path d="M17 10.5V7c0-.55-.45-1-1-1H4c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h12c.55 0 1-.45 1-1v-3.5l4 4v-11l-4 4z"/></svg>
        Gravar V√≠deo
      </button>
    </div>

    <div class="card">
      <h3 style="margin-bottom: 16px;">üìç Apenas Localiza√ß√£o</h3>
      <button class="btn btn-success" id="getLocationBtn">
        <svg width="20" height="20" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5a2.5 2.5 0 0 1 0-5 2.5 2.5 0 0 1 0 5z"/></svg>
        Capturar Localiza√ß√£o
      </button>
    </div>

<!-- Preview da foto capturada -->
<div id="photoPreview" class="card" style="display: none;">
  <div id="photoGallery" class="photo-gallery"></div>
  <button type="button" class="btn btn-secondary" id="addMorePhotosBtn" style="margin-bottom: 12px;">+ Adicionar mais fotos</button>

  <div class="coords-display">
    <div class="label">COORDENADAS</div>
    <span id="previewCoords">Obtendo localiza√ß√£o...</span>
  </div>

  <div class="textarea-wrapper">
    <textarea id="notesInput" placeholder="Adicione observa√ß√µes sobre a foto/local..."></textarea>
    <button type="button" class="btn-mic" id="micBtnPhoto" title="Falar observa√ß√£o">
      <svg width="20" height="20" fill="currentColor" viewBox="0 0 24 24"><path d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3zm-1-9c0-.55.45-1 1-1s1 .45 1 1v6c0 .55-.45 1-1 1s-1-.45-1-1V5z"/><path d="M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z"/></svg>
    </button>
  </div>

  <div class="tags-input" style="margin-top: 8px;">
    <div id="selectedTagsPhoto" class="selected-tags" style="display: flex; flex-wrap: wrap; gap: 4px; margin-bottom: 8px;"></div>
    <div style="display: flex; gap: 8px;">
      <input type="text" id="tagInputPhoto" placeholder="Nova tag..." style="flex: 1; padding: 8px; border: 1px solid var(--border); border-radius: 8px; background: rgba(255,255,255,0.05); color: var(--text);">
      <button type="button" class="btn btn-secondary btn-small" id="addTagBtnPhoto">+</button>
    </div>
    <div id="suggestedTagsPhoto" class="suggested-tags" style="display: flex; flex-wrap: wrap; gap: 4px; margin-top: 8px;"></div>
  </div>

  <div class="btn-group">
    <button class="btn btn-secondary" id="cancelPhotoBtn">Cancelar</button>
    <button class="btn btn-primary" id="savePhotoBtn">Salvar</button>
  </div>
</div>

<!-- Preview do v√≠deo capturado -->
<div id="videoPreview" class="card" style="display: none;">
  <video id="previewVideo" class="preview-video" controls></video>

  <div class="coords-display">
    <div class="label">COORDENADAS</div>
    <span id="previewVideoCoords">Obtendo localiza√ß√£o...</span>
  </div>

  <div class="textarea-wrapper">
    <textarea id="videoNotesInput" placeholder="Adicione observa√ß√µes sobre o v√≠deo/local..."></textarea>
    <button type="button" class="btn-mic" id="micBtnVideo" title="Falar observa√ß√£o">
      <svg width="20" height="20" fill="currentColor" viewBox="0 0 24 24"><path d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3zm-1-9c0-.55.45-1 1-1s1 .45 1 1v6c0 .55-.45 1-1 1s-1-.45-1-1V5z"/><path d="M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z"/></svg>
    </button>
  </div>

  <div class="tags-input" style="margin-top: 8px;">
    <div id="selectedTagsVideo" class="selected-tags" style="display: flex; flex-wrap: wrap; gap: 4px; margin-bottom: 8px;"></div>
    <div style="display: flex; gap: 8px;">
      <input type="text" id="tagInputVideo" placeholder="Nova tag..." style="flex: 1; padding: 8px; border: 1px solid var(--border); border-radius: 8px; background: rgba(255,255,255,0.05); color: var(--text);">
      <button type="button" class="btn btn-secondary btn-small" id="addTagBtnVideo">+</button>
    </div>
    <div id="suggestedTagsVideo" class="suggested-tags" style="display: flex; flex-wrap: wrap; gap: 4px; margin-top: 8px;"></div>
  </div>

  <div class="btn-group">
    <button class="btn btn-secondary" id="cancelVideoBtn">Cancelar</button>
    <button class="btn btn-primary" id="saveVideoBtn">Salvar</button>
  </div>
</div>

<!-- Preview apenas localiza√ß√£o -->
<div id="locationPreview" class="card" style="display: none;">
  <div class="coords-display">
    <div class="label">COORDENADAS</div>
    <span id="locationCoords">Obtendo localiza√ß√£o...</span>
  </div>

  <div class="textarea-wrapper">
    <textarea id="locationNotesInput" placeholder="Adicione observa√ß√µes sobre este local..."></textarea>
    <button type="button" class="btn-mic" id="micBtnLocation" title="Falar observa√ß√£o">
      <svg width="20" height="20" fill="currentColor" viewBox="0 0 24 24"><path d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3zm-1-9c0-.55.45-1 1-1s1 .45 1 1v6c0 .55-.45 1-1 1s-1-.45-1-1V5z"/><path d="M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z"/></svg>
    </button>
  </div>

  <div class="tags-input" style="margin-top: 8px;">
    <div id="selectedTagsLocation" class="selected-tags" style="display: flex; flex-wrap: wrap; gap: 4px; margin-bottom: 8px;"></div>
    <div style="display: flex; gap: 8px;">
      <input type="text" id="tagInputLocation" placeholder="Nova tag..." style="flex: 1; padding: 8px; border: 1px solid var(--border); border-radius: 8px; background: rgba(255,255,255,0.05); color: var(--text);">
      <button type="button" class="btn btn-secondary btn-small" id="addTagBtnLocation">+</button>
    </div>
    <div id="suggestedTagsLocation" class="suggested-tags" style="display: flex; flex-wrap: wrap; gap: 4px; margin-top: 8px;"></div>
  </div>

  <div class="btn-group">
    <button class="btn btn-secondary" id="cancelLocationBtn">Cancelar</button>
    <button class="btn btn-primary" id="saveLocationBtn">Salvar</button>
  </div>
    </div>

  </div>

  <!-- View: Hist√≥rico -->

  <div id="history" class="view">
    <!-- Filtros de busca -->
    <div class="card" style="padding: 12px;">
      <input type="text" id="searchInput" placeholder="Buscar nas observa√ß√µes..." style="width: 100%; padding: 10px; border: 1px solid var(--border); border-radius: 8px; margin-bottom: 8px; background: rgba(255,255,255,0.05); color: var(--text);">
      <div style="display: flex; gap: 8px;">
        <select id="filterType" style="flex: 1; padding: 8px; border: 1px solid var(--border); border-radius: 8px; background: rgba(255,255,255,0.1); color: var(--text);">
          <option value="all">Todos</option>
          <option value="photo">üì∏ Fotos</option>
          <option value="video">üé¨ V√≠deos</option>
          <option value="location">üìç Localiza√ß√µes</option>
        </select>
        <select id="filterSort" style="flex: 1; padding: 8px; border: 1px solid var(--border); border-radius: 8px; background: rgba(255,255,255,0.1); color: var(--text);">
          <option value="newest">Mais recentes</option>
          <option value="oldest">Mais antigos</option>
          <option value="withNotes">Com observa√ß√µes</option>
        </select>
      </div>
    </div>

    <!-- Modo sele√ß√£o -->
    <button class="btn btn-secondary btn-small" id="selectModeBtn" style="margin-bottom: 12px;">‚òëÔ∏è Selecionar</button>

    <!-- Barra de sele√ß√£o -->
    <div id="selectionBar" class="selection-bar" style="display: none;">
      <span id="selectedCount">0 selecionados</span>
      <button class="btn btn-primary btn-small" id="shareSelectedBtn">üì§ Compartilhar</button>
      <button class="btn btn-secondary btn-small" id="cancelSelectionBtn">Cancelar</button>
    </div>

    <div id="recordsList"></div>
    <div id="emptyState" class="empty-state">
      <svg fill="currentColor" viewBox="0 0 24 24"><path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/></svg>
      <p>Nenhum registro ainda</p>
      <p style="font-size: 13px;">Capture fotos ou localiza√ß√µes para come√ßar</p>
    </div>
  </div>

  <!-- View: Mapa -->

  <div id="map" class="view">
    <div id="mapContainer" style="width: 100%; height: calc(100vh - 140px); border-radius: 12px; overflow: hidden;"></div>
  </div>

  <!-- View: Configura√ß√µes -->

  <div id="settings" class="view">
    <div class="card">
      <h3 style="margin-bottom: 16px;">üíæ Backup dos Dados</h3>
      <p style="font-size: 14px; color: var(--text-secondary); margin-bottom: 16px;">
        Exporte seus dados para n√£o perder fotos, v√≠deos e localiza√ß√µes caso limpe o cache do navegador.
      </p>
      <div class="btn-group" style="flex-direction: column; gap: 12px;">
        <button class="btn btn-primary" id="exportBackupBtn">üì§ Exportar Backup</button>
        <button class="btn btn-secondary" id="importBackupBtn">üì• Importar Backup</button>
        <input type="file" id="importFileInput" accept=".json" style="display: none;">
      </div>
    </div>
    <div class="card">
      <h3 style="margin-bottom: 16px;">‚ö†Ô∏è Zona de Perigo</h3>
      <button class="btn btn-danger" id="clearAllDataBtn">üóëÔ∏è Apagar Todos os Dados</button>
    </div>
  </div>

  <!-- Modal de detalhes -->

  <div class="modal-overlay" id="detailModal">
    <div class="modal">
      <div class="modal-header">Detalhes do Registro</div>
      <div class="modal-body" id="modalContent"></div>
      <div class="modal-footer">
        <button class="btn btn-secondary btn-small" id="closeModalBtn">Fechar</button>
        <button class="btn btn-secondary btn-small" id="editRecordBtn">‚úèÔ∏è Editar</button>
        <button class="btn btn-danger btn-small" id="deleteRecordBtn">Excluir</button>
        <button class="btn btn-secondary btn-small" id="savePhotoModalBtn" style="display:none;">üíæ Foto</button>
        <button class="btn btn-primary btn-small" id="shareRecordBtn">Enviar</button>
      </div>
    </div>
  </div>

  <!-- Modal de edi√ß√£o -->

  <div class="modal-overlay" id="editModal">
    <div class="modal">
      <div class="modal-header">Editar Registro</div>
      <div class="modal-body">
        <label style="font-size: 12px; color: var(--text-secondary);">Observa√ß√µes:</label>
        <div class="textarea-wrapper">
          <textarea id="editNotesInput" placeholder="Observa√ß√µes..."></textarea>
          <button type="button" class="btn-mic" id="micBtnEdit" title="Falar observa√ß√£o">
            <svg width="20" height="20" fill="currentColor" viewBox="0 0 24 24"><path d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3zm-1-9c0-.55.45-1 1-1s1 .45 1 1v6c0 .55-.45 1-1 1s-1-.45-1-1V5z"/><path d="M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z"/></svg>
          </button>
        </div>
        <div id="editTagsContainer" style="margin-top: 12px;">
          <label style="font-size: 12px; color: var(--text-secondary);">Tags:</label>
          <div id="editSelectedTags" class="selected-tags" style="display: flex; flex-wrap: wrap; gap: 4px; margin: 8px 0;"></div>
          <div style="display: flex; gap: 8px;">
            <input type="text" id="editTagInput" placeholder="Nova tag..." style="flex: 1; padding: 8px; border: 1px solid var(--border); border-radius: 8px; background: rgba(255,255,255,0.05); color: var(--text);">
            <button type="button" class="btn btn-secondary btn-small" id="addEditTagBtn">+</button>
          </div>
          <div id="editSuggestedTags" class="suggested-tags" style="display: flex; flex-wrap: wrap; gap: 4px; margin-top: 8px;"></div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary btn-small" id="cancelEditBtn">Cancelar</button>
        <button class="btn btn-primary btn-small" id="saveEditBtn">Salvar</button>
      </div>
    </div>
  </div>

  <!-- Toast -->

  <div class="toast" id="toast"></div>

  <!-- Install prompt Android -->

  <div class="install-prompt" id="installPrompt">
    <p><strong>Instalar GeoFotos?</strong><br>Adicione √† tela inicial para acesso r√°pido.</p>
    <div class="btn-group">
      <button class="btn btn-secondary btn-small" id="dismissInstall">Agora n√£o</button>
      <button class="btn btn-primary btn-small" id="installBtn">Instalar</button>
    </div>
  </div>

  <!-- Install prompt iOS -->

  <div class="install-prompt" id="iosInstallPrompt">
    <p><strong>Instalar GeoFotos</strong><br>Toque em <span style="font-size:18px;">‚¨ÜÔ∏è</span> e depois em <strong>"Adicionar √† Tela de In√≠cio"</strong></p>
    <div class="btn-group">
      <button class="btn btn-secondary btn-small" id="dismissIosInstall">Entendi</button>
    </div>
  </div>

  <!-- Scripts -->
  <script src="js/utils.js"></script>
  <script src="js/db.js"></script>
  <script src="js/speech.js"></script>
  <script src="js/capture.js"></script>
  <script src="js/history.js"></script>
  <script src="js/backup.js"></script>
  <script src="js/map.js"></script>
  <script src="js/app.js"></script>

</body>
</html>
